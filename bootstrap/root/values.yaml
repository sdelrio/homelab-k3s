gitops:
  repo: https://github.com/sdelrio/homelab-k3s
  revision: master
stacks:
  - name: bootstrap
    app_namespace: argocd
    proj_namespaces: ["argocd"]
    whitelist:
      - group: rbac.authorization.k8s.io
        kind: ClusterRole
      - group: rbac.authorization.k8s.io
        kind: ClusterRoleBinding
      - group: '*'
        kind: CustomResourceDefinition
#    sync: true
  - name: platform
    proj_namespaces:
      - external-secrets
      - vault-server
    whitelist:
      - group: rbac.authorization.k8s.io
        kind: ClusterRole
      - group: rbac.authorization.k8s.io
        kind: ClusterRoleBinding
      - group: '*'
        kind: CustomResourceDefinition
      - group: admissionregistration.k8s.io
        kind: ValidatingWebhookConfiguration
      - group: external-secrets.io
        kind: ClusterSecretStore
#    sync: true
  - name: system-external
    path: 'system/external'
    proj_namespaces:
      - cert-manager
      - external-dns
    whitelist:
      - group: rbac.authorization.k8s.io
        kind: ClusterRole
      - group: rbac.authorization.k8s.io
        kind: ClusterRoleBinding
      - group: '*'
        kind: CustomResourceDefinition
      - group: admissionregistration.k8s.io
        kind: MutatingWebhookConfiguration
      - group: admissionregistration.k8s.io
        kind: ValidatingWebhookConfiguration
      - group: cert-manager.io
        kind: ClusterIssuer
  - name: system-internal
    path: 'system/internal'
    replace: true
    proj_namespaces:
      - intel-gpu-plugin
      - kyverno
      - nf-discovery
      - reloader
      - vault-operator
    whitelist:
      - group: rbac.authorization.k8s.io
        kind: ClusterRole
      - group: rbac.authorization.k8s.io
        kind: ClusterRoleBinding
      - group: '*'
        kind: CustomResourceDefinition
  - name: system-network
    path: 'system/network'
    proj_namespaces:
      - cilium
      - metallb-system
      - nginx-external
      - nginx-internal
    whitelist:
      - group: rbac.authorization.k8s.io
        kind: ClusterRole
      - group: rbac.authorization.k8s.io
        kind: ClusterRoleBinding
      - group: '*'
        kind: CustomResourceDefinition
      - group: metallb.io
        kind: IPAddressPool
      - group: metallb.io
        kind: L2Advertisement
      - group: admissionregistration.k8s.io
        kind: ValidatingWebhookConfiguration
      - group: networking.k8s.io
        kind: IngressClass
  - name: system-storage
    path: 'system/storage'
    helm_extra: true
    whitelist:
      - group: rbac.authorization.k8s.io
        kind: ClusterRole
      - group: rbac.authorization.k8s.io
        kind: ClusterRoleBinding
      - group: '*'
        kind: CustomResourceDefinition
      - group: storage.k8s.io
        kind: StorageClass
      - group: storage.k8s.io
        kind: CSIStorageCapacity
      - group: piraeus.linbit.com
        kind: LinstorController
      - group: piraeus.linbit.com
        kind: LinstorCSIDriver
      - group: piraeus.linbit.com
        kind: LinstorSatelliteSet
      - group: snapshot.storage.k8s.io
        kind: VolumeSnapshotClass
    proj_namespaces:
      - openebs-localpv
      - piraeus-operator
      - piraeus-storageclass
      - volume-snapshot-crds
#    sync: true
#  - name: apps
